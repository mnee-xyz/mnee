!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("@bsv/sdk"),require("js-1sat-ord")):"function"==typeof define&&define.amd?define(["@bsv/sdk","js-1sat-ord"],r):(e||self).mnee=r(e.bsv,e.js1SatOrd)}(this,function(e,r){function t(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach(function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}}),r.default=e,r}var n=/*#__PURE__*/t(r);function o(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}function i(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(t)return(t=t.call(e)).next.bind(t);if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return o(e,r);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?o(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=/*#__PURE__*/function(){function r(){}var t=r.prototype;return t.lock=function(r,t){var n=[];if("string"==typeof r){var o=e.Utils.fromBase58Check(r);if(0!==o.prefix[0]&&111!==o.prefix[0])throw new Error("only P2PKH is supported");n=o.data}else n=r;var i=new e.LockingScript;return i.writeOpCode(e.OP.OP_DUP).writeOpCode(e.OP.OP_HASH160).writeBin(n).writeOpCode(e.OP.OP_EQUALVERIFY).writeOpCode(e.OP.OP_CHECKSIGVERIFY).writeBin(t.encode(!0)).writeOpCode(e.OP.OP_CHECKSIG),i},t.userUnlock=function(r,t,n,o,i){return void 0===t&&(t="all"),void 0===n&&(n=!1),{sign:function(s,a){try{var u,c,f,d=e.TransactionSignature.SIGHASH_FORKID;"all"===t&&(d|=e.TransactionSignature.SIGHASH_ALL),"none"===t&&(d|=e.TransactionSignature.SIGHASH_NONE),"single"===t&&(d|=e.TransactionSignature.SIGHASH_SINGLE),n&&(d|=e.TransactionSignature.SIGHASH_ANYONECANPAY);var l=s.inputs[a],h=s.inputs.filter(function(e,r){return r!==a}),p=l.sourceTXID?l.sourceTXID:null==(u=l.sourceTransaction)?void 0:u.id("hex");if(!p)throw new Error("The input sourceTXID or sourceTransaction is required for transaction signing.");if(o||(o=null==(c=l.sourceTransaction)?void 0:c.outputs[l.sourceOutputIndex].satoshis),!o)throw new Error("The sourceSatoshis or input sourceTransaction is required for transaction signing.");if(i||(i=null==(f=l.sourceTransaction)?void 0:f.outputs[l.sourceOutputIndex].lockingScript),!i)throw new Error("The lockingScript or input sourceTransaction is required for transaction signing.");var v=e.TransactionSignature.format({sourceTXID:p,sourceOutputIndex:l.sourceOutputIndex,sourceSatoshis:o,transactionVersion:s.version,otherInputs:h,inputIndex:a,outputs:s.outputs,inputSequence:l.sequence||4294967295,subscript:i,lockTime:s.lockTime,scope:d}),m=r.sign(e.Hash.sha256(v)),g=new e.TransactionSignature(m.r,m.s,d),P=new e.UnlockingScript;return P.writeBin(g.toChecksigFormat()),P.writeBin(r.toPublicKey().encode(!0)),Promise.resolve(P)}catch(e){return Promise.reject(e)}},estimateLength:function(){return Promise.resolve(182)}}},t.unlock=function(r,t,n,o,i,s){return void 0===n&&(n="all"),void 0===o&&(o=!1),{sign:function(a,u){try{var c,f,d,l=e.TransactionSignature.SIGHASH_FORKID;"all"===n&&(l|=e.TransactionSignature.SIGHASH_ALL),"none"===n&&(l|=e.TransactionSignature.SIGHASH_NONE),"single"===n&&(l|=e.TransactionSignature.SIGHASH_SINGLE),o&&(l|=e.TransactionSignature.SIGHASH_ANYONECANPAY);var h=a.inputs[u],p=a.inputs.filter(function(e,r){return r!==u}),v=h.sourceTXID?h.sourceTXID:null==(c=h.sourceTransaction)?void 0:c.id("hex");if(!v)throw new Error("The input sourceTXID or sourceTransaction is required for transaction signing.");if(i||(i=null==(f=h.sourceTransaction)?void 0:f.outputs[h.sourceOutputIndex].satoshis),!i)throw new Error("The sourceSatoshis or input sourceTransaction is required for transaction signing.");if(s||(s=null==(d=h.sourceTransaction)?void 0:d.outputs[h.sourceOutputIndex].lockingScript),!s)throw new Error("The lockingScript or input sourceTransaction is required for transaction signing.");var m=e.TransactionSignature.format({sourceTXID:v,sourceOutputIndex:h.sourceOutputIndex,sourceSatoshis:i,transactionVersion:a.version,otherInputs:p,inputIndex:u,outputs:a.outputs,inputSequence:h.sequence||4294967295,subscript:s,lockTime:a.lockTime,scope:l}),g=r.sign(e.Hash.sha256(m)),P=new e.TransactionSignature(g.r,g.s,l),T=new e.UnlockingScript;return T.writeBin(P.toChecksigFormat()),T.writeScript(t),Promise.resolve(T)}catch(e){return Promise.reject(e)}},estimateLength:function(){return Promise.resolve(182)}}},r}(),a=function(r){for(var t,n,o,i=0;i<r.chunks.length;i++){var s,a=r.chunks[i];i>=2&&3===(null==(s=a.data)?void 0:s.length)&&"ord"==e.Utils.toUTF8(a.data)&&r.chunks[i-1].op==e.OP.OP_IF&&r.chunks[i-2].op==e.OP.OP_FALSE&&(o=i+1)}if(void 0!==o){for(var u={file:{hash:"",size:0,type:""},fields:{}},c=o;c<r.chunks.length;c+=2){var f,d,l=r.chunks[c];if(l.op==e.OP.OP_ENDIF)break;if(l.op>e.OP.OP_16)return;var h=r.chunks[c+1];if(h.op>e.OP.OP_PUSHDATA4)return;if(null==(f=l.data)||!f.length){var p=0;switch(l.op>e.OP.OP_PUSHDATA4&&l.op<=e.OP.OP_16?p=l.op-80:null!=(d=l.data)&&d.length&&(p=l.data[0]),p){case 0:if(u.file.size=(null==(t=h.data)?void 0:t.length)||0,null==(n=h.data)||!n.length)break;u.file.hash=e.Utils.toBase64(e.Hash.sha256(h.data)),u.file.content=h.data;break;case 1:u.file.type=Buffer.from(h.data||[]).toString()}}}return u}},u=function(r){return r.map(function(r){for(var t=r.chunks,n=0;n<=t.length-4;n++){var o,i,s;if(t.length>n+6&&t[0+n].op===e.OP.OP_DUP&&t[1+n].op===e.OP.OP_HASH160&&20===(null==(o=t[2+n].data)?void 0:o.length)&&t[3+n].op===e.OP.OP_EQUALVERIFY&&t[4+n].op===e.OP.OP_CHECKSIGVERIFY&&33===(null==(i=t[5+n].data)?void 0:i.length)&&t[6+n].op===e.OP.OP_CHECKSIG)return{cosigner:e.Utils.toHex(t[5+n].data||[]),address:e.Utils.toBase58Check(t[2+n].data||[],[0])};if(t[0+n].op===e.OP.OP_DUP&&t[1+n].op===e.OP.OP_HASH160&&20===(null==(s=t[2+n].data)?void 0:s.length)&&t[3+n].op===e.OP.OP_EQUALVERIFY&&t[4+n].op===e.OP.OP_CHECKSIG)return{cosigner:"",address:e.Utils.toBase58Check(t[2+n].data||[],[0])}}})},c=function(r,t,n){var o=r.senders.includes(t)?"send":"receive",i=r.height>0?"confirmed":"unconfirmed";if(!r.rawtx)return null;var s=e.Utils.toArray(r.rawtx,"base64"),c=e.Utils.toHex(s),f=e.Transaction.fromHex(c).outputs.map(function(e){return e.lockingScript}),d=u(f),l=f.map(a),h=d.map(function(e){return e.address}),p=h.indexOf(n.feeAddress),v=r.senders[0],m=0,g=new Map;l.forEach(function(r,o){var i,s=null==r||null==(i=r.file)?void 0:i.content;if(s){var a=e.Utils.toUTF8(s);if(a){var u;try{u=JSON.parse(a)}catch(e){return void console.error("Failed to parse inscription JSON:",e)}if("bsv-20"===u.p&&u.id===n.tokenId){var c=parseInt(u.amt,10);if(!Number.isNaN(c))if(p!==o||v!==t){var f=h[o],d=g.get(f)||0;g.set(f,d+c)}else m+=c}}}});var P=g.get(t)||0;if("send"===o){var T=g.get(v)||0;g.set(v,T-P)}var S=[],w=(S="receive"===o?[{address:v,amount:P}]:Array.from(g.entries()).map(function(e){return{address:e[0],amount:e[1]}}).filter(function(e){return e.address!==t&&e.address!==n.feeAddress&&e.amount>0})).reduce(function(e,r){return e+r.amount},0);return{txid:r.txid,height:r.height,type:o,status:i,amount:w,fee:m,score:r.score,counterparties:S}};function f(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}function d(e,r,t){if(!e.s){if(t instanceof l){if(!t.s)return void(t.o=d.bind(null,e,r));1&r&&(r=t.s),t=t.v}if(t&&t.then)return void t.then(d.bind(null,e,r),d.bind(null,e,2));e.s=r,e.v=t;var n=e.o;n&&n(e)}}var l=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(r,t){var n=new e,o=this.s;if(o){var i=1&o?r:t;if(i){try{d(n,1,i(this.v))}catch(e){d(n,2,e)}return n}return this}return this.o=function(e){try{var o=e.v;1&e.s?d(n,1,r?r(o):o):t?d(n,1,t(o)):d(n,2,o)}catch(e){d(n,2,e)}},n},e}();function h(e){return e instanceof l&&1&e.s}var p="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function v(e,r,t){if("function"==typeof e[p]){var n,o,i,s=function(e){try{for(;!((n=a.next()).done||t&&t());)if((e=r(n.value))&&e.then){if(!h(e))return void e.then(s,i||(i=d.bind(null,o=new l,2)));e=e.v}o?d(o,1,e):o=e}catch(e){d(o||(o=new l),2,e)}},a=e[p]();if(s(),a.return){var u=function(e){try{n.done||a.return()}catch(e){}return e};if(o&&o.then)return o.then(u,function(e){throw u(e)});u()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var c=[],f=0;f<e.length;f++)c.push(e[f]);return function(e,r,t){var n,o,i=-1;return function s(a){try{for(;++i<e.length&&(!t||!t());)if((a=r(i))&&a.then){if(!h(a))return void a.then(s,o||(o=d.bind(null,n=new l,2)));a=a.v}n?d(n,1,a):n=a}catch(e){d(n||(n=new l),2,e)}}(),n}(c,function(e){return r(c[e])},t)}var m=/*#__PURE__*/function(){function r(e){this.mneeApiToken="92982ec1c0975f31979da515d46bae9f",this.prodTokenId="ae59f3b898ec61acbdb6cc7a245fabeded0c094bf046f35206a3aec60ef88127_0",this.prodApprover="020a177d6a5e6f3a8689acd2e313bd1cf0dcf5a243d1cc67b7218602aee9e04b2f",this.prodAddress="1inHbiwj2jrEcZPiSYnfgJ8FmS1Bmk4Dh",this.devTokenId="833a7720966a2a435db28d967385e8aa7284b6150ebb39482cc5228b73e1703f_0",this.devAddress="1A1QNEkLuvAALsmG4Me3iubP8zb5C6jpv5",this.qaTokenId="55cde0733049a226fdb6abc387ee9dcd036e859f7cbc69ab90050c0435139f00_0",this.qaAddress="1BW7cejD27vDLiHsbK1Hvf1y4JTKvC1Yue",this.stageTokenId="833a7720966a2a435db28d967385e8aa7284b6150ebb39482cc5228b73e1703f_0",this.stageAddress="1AZNdbFYBDFTAEgzZMfPzANxyNrpGJZAUY",this.mneeApi="https://proxy-api.mnee.net",this.gorillaPoolApi="https://ordinals.1sat.app",this.mneeConfig=void 0,e&&(this.mneeApiToken=e),this.getConfig()}var t=r.prototype;return t.getConfig=function(){try{var e=this;return Promise.resolve(f(function(){return Promise.resolve(fetch(e.mneeApi+"/v1/config?auth_token="+e.mneeApiToken,{method:"GET"})).then(function(r){if(!r.ok)throw new Error("HTTP error! status: "+r.status);return Promise.resolve(r.json()).then(function(r){return e.mneeConfig=r,r})})},function(e){console.error("Failed to fetch config:",e)}))}catch(e){return Promise.reject(e)}},t.toAtomicAmount=function(e){if(!this.mneeConfig)throw new Error("Config not fetched");return Math.round(e*Math.pow(10,this.mneeConfig.decimals))},t.fromAtomicAmount=function(e){if(!this.mneeConfig)throw new Error("Config not fetched");return e/Math.pow(10,this.mneeConfig.decimals)},t.createInscription=function(r,t,o){try{var i={p:"bsv-20",op:"transfer",id:o.tokenId,amt:t.toString()};return Promise.resolve({lockingScript:n.applyInscription((new s).lock(r,e.PublicKey.fromString(o.approver)),{dataB64:Buffer.from(JSON.stringify(i)).toString("base64"),contentType:"application/bsv-20"}),satoshis:1})}catch(e){return Promise.reject(e)}},t.getUtxos=function(e,r){void 0===r&&(r=["transfer","deploy+mint"]);try{var t=this;return Promise.resolve(f(function(){return Promise.resolve(fetch(t.mneeApi+"/v1/utxos?auth_token="+t.mneeApiToken,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([e])})).then(function(e){if(!e.ok)throw new Error("HTTP error! status: "+e.status);return Promise.resolve(e.json()).then(function(e){return r.length?e.filter(function(e){return r.includes(e.data.bsv21.op.toLowerCase())}):e})})},function(e){return console.error("Failed to fetch UTXOs:",e),[]}))}catch(e){return Promise.reject(e)}},t.broadcast=function(e){try{var r=this.gorillaPoolApi+"/v5/tx";return Promise.resolve(f(function(){return Promise.resolve(fetch(r,{method:"POST",headers:{"Content-Type":"application/octet-stream"},body:Buffer.from(e.toBinary())})).then(function(e){return Promise.resolve(e.json()).then(function(r){return e.ok?{status:"success",txid:r.txid,message:"Transaction broadcast successfully"}:{status:"error",code:e.status.toString(),description:r.error||"Unknown error"}})})},function(e){return console.error("Failed to broadcast:",e),{status:"error",code:"UNKNOWN",description:e instanceof Error?e.message:"Unknown error"}}))}catch(e){return Promise.reject(e)}},t.fetchBeef=function(r){try{return Promise.resolve(fetch(this.gorillaPoolApi+"/v5/tx/"+r+"/beef")).then(function(t){if(404===t.status)throw new Error("Transaction not found");if(200!==t.status)throw new Error(t.status+" - Failed to fetch beef for tx "+r);var n=Buffer,o=n.from;return Promise.resolve(t.arrayBuffer()).then(function(r){var t=[].concat(o.call(n,r));return e.Transaction.fromAtomicBEEF(t)})})}catch(e){return Promise.reject(e)}},t.getSignatures=function(r,t){try{try{var n;switch(r.format){case"beef":n=e.Transaction.fromHexBEEF(r.rawtx);break;case"ef":n=e.Transaction.fromHexEF(r.rawtx);break;default:n=e.Transaction.fromHex(r.rawtx)}var o=r.sigRequests.flatMap(function(r){return[t].map(function(t){var o=e.TransactionSignature.format({sourceTXID:r.prevTxid,sourceOutputIndex:r.outputIndex,sourceSatoshis:r.satoshis,transactionVersion:n.version,otherInputs:n.inputs.filter(function(e,t){return t!==r.inputIndex}),inputIndex:r.inputIndex,outputs:n.outputs,inputSequence:n.inputs[r.inputIndex].sequence||0,subscript:r.script?e.Script.fromHex(r.script):(new e.P2PKH).lock(t.toPublicKey().toAddress()),lockTime:n.lockTime,scope:r.sigHashType||65}),i=t.sign(e.Hash.sha256(o)),s=new e.TransactionSignature(i.r,i.s,r.sigHashType||65);return{sig:e.Utils.toHex(s.toChecksigFormat()),pubKey:t.toPublicKey().toString(),inputIndex:r.inputIndex,sigHashType:r.sigHashType||65,csIdx:r.csIdx}})});return Promise.resolve({sigResponses:o})}catch(e){var i;return console.error("getSignatures error",e),Promise.resolve({error:{message:null!=(i=e.message)?i:"unknown",cause:e.cause}})}}catch(e){return Promise.reject(e)}},t.transfer=function(r,t){try{var n=this;return Promise.resolve(f(function(){function o(o){if(!o)throw new Error("Config not fetched");var s=r.reduce(function(e,r){return e+r.amount},0);if(s<=0)return{error:"Invalid amount"};var a=n.toAtomicAmount(s),u=e.PrivateKey.fromWif(t),c=u.toAddress();return Promise.resolve(n.getUtxos(c)).then(function(t){var s,c;function f(t){if(c)return t;function s(){function r(){function r(){var r=m.inputs.map(function(r,t){var n,o;if(!r.sourceTXID)throw new Error("Source TXID is undefined");return{prevTxid:r.sourceTXID,outputIndex:r.sourceOutputIndex,inputIndex:t,address:P[t],script:null==(n=r.sourceTransaction)?void 0:n.outputs[r.sourceOutputIndex].lockingScript.toHex(),satoshis:(null==(o=r.sourceTransaction)?void 0:o.outputs[r.sourceOutputIndex].satoshis)||1,sigHashType:e.TransactionSignature.SIGHASH_ALL|e.TransactionSignature.SIGHASH_ANYONECANPAY|e.TransactionSignature.SIGHASH_FORKID}}),t=m.toHex();return Promise.resolve(n.getSignatures({rawtx:t,sigRequests:r},u)).then(function(r){if(null==r||!r.sigResponses)return{error:"Failed to get signatures"};for(var t,o=i(r.sigResponses);!(t=o()).done;){var s=t.value;m.inputs[s.inputIndex].unlockingScript=(new e.Script).writeBin(e.Utils.toArray(s.sig,"hex")).writeBin(e.Utils.toArray(s.pubKey,"hex"))}var a=e.Utils.toBase64(m.toBinary());return Promise.resolve(fetch(n.mneeApi+"/v1/transfer?auth_token="+n.mneeApiToken,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rawtx:a})})).then(function(r){if(!r.ok)throw new Error("HTTP error! status: "+r.status);return Promise.resolve(r.json()).then(function(r){var t=r.rawtx;if(!t)return{error:"Failed to broadcast transaction"};var o=e.Utils.toArray(t,"base64"),i=e.Transaction.fromBinary(o);return Promise.resolve(n.broadcast(i)).then(function(){return{txid:i.id("hex"),rawtx:e.Utils.toHex(o)}})})})})}var t=g-a-p,s=function(){if(t>0){var e=m.addOutput;return Promise.resolve(n.createInscription(T,t,o)).then(function(r){e.call(m,r)})}}();return s&&s.then?s.then(r):r()}var t=function(){if(p>0){var e=m.addOutput;return Promise.resolve(n.createInscription(o.feeAddress,p,o)).then(function(r){e.call(m,r)})}}();return t&&t.then?t.then(r):r()}var f=v(r,function(e){var r=m.addOutput;return Promise.resolve(n.createInscription(e.address,n.toAtomicAmount(e.amount),o)).then(function(e){r.call(m,e)})});return f&&f.then?f.then(s):s()}if(t.reduce(function(e,r){return e+(r.data.bsv21.amt||0)},0)<a)return{error:"Insufficient MNEE balance"};var p=void 0!==r.find(function(e){return e.address===o.burnAddress})?0:null==(s=o.fees.find(function(e){return a>=e.min&&a<=e.max}))?void 0:s.fee;if(void 0===p)return{error:"Fee ranges inadequate"};var m=new e.Transaction(1,[],[],0),g=0,P=[],T="",S=function(e,r,t){for(var n;;){var o=e();if(h(o)&&(o=o.v),!o)return i;if(o.then){n=0;break}var i=t();if(i&&i.then){if(!h(i)){n=1;break}i=i.s}}var s=new l,a=d.bind(null,s,2);return(0===n?o.then(c):1===n?i.then(u):(void 0).then(function(){(o=e())?o.then?o.then(c).then(void 0,a):c(o):d(s,1,i)})).then(void 0,a),s;function u(r){i=r;do{if(!(o=e())||h(o)&&!o.v)return void d(s,1,i);if(o.then)return void o.then(c).then(void 0,a);h(i=t())&&(i=i.v)}while(!i||!i.then);i.then(u).then(void 0,a)}function c(e){e?(i=t())&&i.then?i.then(u).then(void 0,a):u(i):d(s,1,i)}}(function(){return!c&&g<a+p},0,function(){var r=t.shift();return r?Promise.resolve(n.fetchBeef(r.txid)).then(function(t){if(!t)return c=1,{error:"Failed to fetch source transaction"};P.push(r.owners[0]),T=T||r.owners[0],m.addInput({sourceTXID:r.txid,sourceOutputIndex:r.vout,sourceTransaction:t,unlockingScript:new e.UnlockingScript}),g+=r.data.bsv21.amt}):(c=1,{error:"Insufficient MNEE balance"})});return S&&S.then?S.then(f):f(S)})}var s=n.mneeConfig;return s?o(s):Promise.resolve(n.getConfig()).then(o)},function(e){var r="Transaction submission failed";return e instanceof Error&&(r=e.message,e.message.includes("HTTP error")&&console.error("HTTP error details:",e)),console.error("Failed to transfer tokens:",r),{error:r}}))}catch(e){return Promise.reject(e)}},t.getBalance=function(e){try{var r=this;return Promise.resolve(f(function(){function t(t){if(!t)throw new Error("Config not fetched");return Promise.resolve(r.getUtxos(e)).then(function(e){var t=e.reduce(function(e,r){return"transfer"===r.data.bsv21.op&&(e+=r.data.bsv21.amt),e},0);return{amount:t,decimalAmount:r.fromAtomicAmount(t)}})}var n=r.mneeConfig;return n?t(n):Promise.resolve(r.getConfig()).then(t)},function(e){return console.error("Failed to fetch balance:",e),{amount:0,decimalAmount:0}}))}catch(e){return Promise.reject(e)}},t.validateMneeTx=function(r,t){try{var n=this;return Promise.resolve(f(function(){function o(o){if(!o)throw new Error("Config not fetched");var i=e.Transaction.fromHex(r),s=i.outputs.map(function(e){return e.lockingScript}),c=u(s);return t?t.forEach(function(r,t){var s,u=r.address,f=r.amount;if(!c.find(function(e){return(null==e?void 0:e.cosigner)===o.approver}))throw new Error("Cosigner not found for address: "+u+" at index: "+t);if(!c.find(function(e){return(null==e?void 0:e.address)===u}))throw new Error("Address not found in script for address: "+u+" at index: "+t);var d=a(i.outputs[t].lockingScript),l=null==d||null==(s=d.file)?void 0:s.content;if(!l)throw new Error("Invalid inscription content");var h=e.Utils.toUTF8(l);if(!h)throw new Error("Invalid inscription content");var p=JSON.parse(h);if("bsv-20"!==p.p)throw new Error("Invalid bsv 20 protocol: "+p.p);if("transfer"!==p.op)throw new Error("Invalid operation: "+p.op);if(p.id!==o.tokenId)throw new Error("Invalid token id: "+p.id);if(p.amt!==n.toAtomicAmount(f).toString())throw new Error("Invalid amount: "+p.amt)}):c.forEach(function(e){if(""!==(null==e?void 0:e.cosigner)&&(null==e?void 0:e.cosigner)!==o.approver)throw new Error("Invalid or missing cosigner")}),!0}var i=n.mneeConfig;return i?o(i):Promise.resolve(n.getConfig()).then(o)},function(e){return console.error(e),!1}))}catch(e){return Promise.reject(e)}},t.getMneeSyncs=function(e,r,t){void 0===r&&(r=0),void 0===t&&(t=100);try{var n=this;return Promise.resolve(f(function(){return Promise.resolve(fetch(n.mneeApi+"/v1/sync?auth_token="+n.mneeApiToken+"&from="+r+"&limit="+t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([e])})).then(function(e){if(!e.ok)throw new Error("HTTP error! status: "+e.status);return Promise.resolve(e.json())})},function(e){console.error("Failed to fetch config:",e)}))}catch(e){return Promise.reject(e)}},t.getRecentTxHistory=function(e,r,t){try{var n=this;return Promise.resolve(f(function(){function o(o){if(!o)throw new Error("Config not fetched");return Promise.resolve(n.getMneeSyncs(e,r,t)).then(function(n){if(!n||0===n.length)return{history:[],nextScore:r||0};for(var s,a=[],u=i(n);!(s=u()).done;){var f=c(s.value,e,o);f&&a.push(f)}var d=a.sort(function(e,r){return r.height-e.height}).sort(function(e,r){return"unconfirmed"===e.status?-1:1});return 0===d.length?{history:[],nextScore:r||0}:t&&d.length>t?{history:d.slice(0,t),nextScore:d[t-1].score}:{history:d,nextScore:a[a.length-1].score}})}var s=n.mneeConfig;return s?o(s):Promise.resolve(n.getConfig()).then(o)},function(e){return console.error("Failed to fetch tx history:",e),{history:[],nextScore:r||0}}))}catch(e){return Promise.reject(e)}},t.parseTx=function(r){try{var t=function(t){if(!t)throw new Error("Config not fetched");return Promise.resolve(n.fetchBeef(r)).then(function(o){function s(){for(var t,o=i(c);!(t=o()).done;){var s,f=t.value,v=u([f])[0],P=a(f),T=null==P||null==(s=P.file)?void 0:s.content;if(T){var S=e.Utils.toUTF8(T);if(S){var w=JSON.parse(S);w&&("burn"===w.op&&(g="burn"),"deploy+mint"===w.op&&(g="deploy"),w.id===n.prodTokenId&&v.cosigner===n.prodApprover||(m=""===v.cosigner&&v.address===n.prodAddress?"prod":"test"),p+=BigInt(w.amt),l.push({address:v.address,amount:parseInt(w.amt)}))}}}if("deploy"!==g&&h!==p)throw new Error("Inputs and outputs are not equal");return r===n.prodTokenId.split("_")[0]?m="prod":[n.devTokenId,n.qaTokenId,n.stageTokenId].some(function(e){return r===e.split("_")[0]})&&(m="test"),{txid:r,environment:m,type:g,inputs:d,outputs:l}}if(!o)throw new Error("Failed to fetch transaction");var c=o.outputs.map(function(e){return e.lockingScript}),f=o.inputs.map(function(e){return{txid:e.sourceTXID,vout:e.sourceOutputIndex}}),d=[],l=[],h=0n,p=0n,m="prod",g="transfer",P=v(f,function(o){if(o.txid)return Promise.resolve(n.fetchBeef(o.txid)).then(function(i){var s,c=i.outputs[o.vout],f=u([c.lockingScript])[0];(null==f?void 0:f.address)===t.mintAddress&&(g=r===t.tokenId.split("_")[0]?"deploy":"mint");var l=a(c.lockingScript),p=null==l||null==(s=l.file)?void 0:s.content;if(p){var v=e.Utils.toUTF8(p);if(v){var P=JSON.parse(v);if(P){var T=f.address===n.prodAddress;P.id===n.prodTokenId&&f.cosigner===n.prodApprover||(""===f.cosigner&&"deploy+mint"===P.op&&T?(m="prod",g="mint"):m="test"),"transfer"===g&&(T||f.address===n.devAddress||f.address===n.qaAddress||f.address===n.stageAddress)&&(g="mint"),h+=BigInt(P.amt),d.push({address:f.address,amount:parseInt(P.amt)})}}}})});return P&&P.then?P.then(s):s()})},n=this,o=n.mneeConfig;return Promise.resolve(o?t(o):Promise.resolve(n.getConfig()).then(t))}catch(e){return Promise.reject(e)}},r}();/*#__PURE__*/
return function(){function e(e){this.service=void 0,this.service=new m(e)}var r=e.prototype;return r.validateMneeTx=function(e,r){try{return Promise.resolve(this.service.validateMneeTx(e,r))}catch(e){return Promise.reject(e)}},r.toAtomicAmount=function(e){return this.service.toAtomicAmount(e)},r.fromAtomicAmount=function(e){return this.service.fromAtomicAmount(e)},r.config=function(){try{return Promise.resolve(this.service.getConfig())}catch(e){return Promise.reject(e)}},r.balance=function(e){try{return Promise.resolve(this.service.getBalance(e))}catch(e){return Promise.reject(e)}},r.transfer=function(e,r){try{return Promise.resolve(this.service.transfer(e,r))}catch(e){return Promise.reject(e)}},r.recentTxHistory=function(e,r,t){try{return Promise.resolve(this.service.getRecentTxHistory(e,r,t))}catch(e){return Promise.reject(e)}},r.parseTx=function(e){try{return Promise.resolve(this.service.parseTx(e))}catch(e){return Promise.reject(e)}},e}()});
//# sourceMappingURL=index.umd.js.map
