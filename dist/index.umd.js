!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@bsv/sdk"),require("js-1sat-ord")):"function"==typeof define&&define.amd?define(["@bsv/sdk","js-1sat-ord"],e):(r||self).mnee=e(r.bsv,r.js1SatOrd)}(this,function(r,e){function t(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var n=/*#__PURE__*/t(e);function o(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=Array(e);t<e;t++)n[t]=r[t];return n}function i(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(t)return(t=t.call(r)).next.bind(t);if(Array.isArray(r)||(t=function(r,e){if(r){if("string"==typeof r)return o(r,e);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?o(r,e):void 0}}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0;return function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=/*#__PURE__*/function(){function e(){}var t=e.prototype;return t.lock=function(e,t){var n=[];if("string"==typeof e){var o=r.Utils.fromBase58Check(e);if(0!==o.prefix[0]&&111!==o.prefix[0])throw new Error("only P2PKH is supported");n=o.data}else n=e;var i=new r.LockingScript;return i.writeOpCode(r.OP.OP_DUP).writeOpCode(r.OP.OP_HASH160).writeBin(n).writeOpCode(r.OP.OP_EQUALVERIFY).writeOpCode(r.OP.OP_CHECKSIGVERIFY).writeBin(t.encode(!0)).writeOpCode(r.OP.OP_CHECKSIG),i},t.userUnlock=function(e,t,n,o,i){return void 0===t&&(t="all"),void 0===n&&(n=!1),{sign:function(s,u){try{var a,c,f,l=r.TransactionSignature.SIGHASH_FORKID;"all"===t&&(l|=r.TransactionSignature.SIGHASH_ALL),"none"===t&&(l|=r.TransactionSignature.SIGHASH_NONE),"single"===t&&(l|=r.TransactionSignature.SIGHASH_SINGLE),n&&(l|=r.TransactionSignature.SIGHASH_ANYONECANPAY);var d=s.inputs[u],h=s.inputs.filter(function(r,e){return e!==u}),v=d.sourceTXID?d.sourceTXID:null==(a=d.sourceTransaction)?void 0:a.id("hex");if(!v)throw new Error("The input sourceTXID or sourceTransaction is required for transaction signing.");if(o||(o=null==(c=d.sourceTransaction)?void 0:c.outputs[d.sourceOutputIndex].satoshis),!o)throw new Error("The sourceSatoshis or input sourceTransaction is required for transaction signing.");if(i||(i=null==(f=d.sourceTransaction)?void 0:f.outputs[d.sourceOutputIndex].lockingScript),!i)throw new Error("The lockingScript or input sourceTransaction is required for transaction signing.");var p=r.TransactionSignature.format({sourceTXID:v,sourceOutputIndex:d.sourceOutputIndex,sourceSatoshis:o,transactionVersion:s.version,otherInputs:h,inputIndex:u,outputs:s.outputs,inputSequence:d.sequence||4294967295,subscript:i,lockTime:s.lockTime,scope:l}),m=e.sign(r.Hash.sha256(p)),g=new r.TransactionSignature(m.r,m.s,l),P=new r.UnlockingScript;return P.writeBin(g.toChecksigFormat()),P.writeBin(e.toPublicKey().encode(!0)),Promise.resolve(P)}catch(r){return Promise.reject(r)}},estimateLength:function(){return Promise.resolve(182)}}},t.unlock=function(e,t,n,o,i,s){return void 0===n&&(n="all"),void 0===o&&(o=!1),{sign:function(u,a){try{var c,f,l,d=r.TransactionSignature.SIGHASH_FORKID;"all"===n&&(d|=r.TransactionSignature.SIGHASH_ALL),"none"===n&&(d|=r.TransactionSignature.SIGHASH_NONE),"single"===n&&(d|=r.TransactionSignature.SIGHASH_SINGLE),o&&(d|=r.TransactionSignature.SIGHASH_ANYONECANPAY);var h=u.inputs[a],v=u.inputs.filter(function(r,e){return e!==a}),p=h.sourceTXID?h.sourceTXID:null==(c=h.sourceTransaction)?void 0:c.id("hex");if(!p)throw new Error("The input sourceTXID or sourceTransaction is required for transaction signing.");if(i||(i=null==(f=h.sourceTransaction)?void 0:f.outputs[h.sourceOutputIndex].satoshis),!i)throw new Error("The sourceSatoshis or input sourceTransaction is required for transaction signing.");if(s||(s=null==(l=h.sourceTransaction)?void 0:l.outputs[h.sourceOutputIndex].lockingScript),!s)throw new Error("The lockingScript or input sourceTransaction is required for transaction signing.");var m=r.TransactionSignature.format({sourceTXID:p,sourceOutputIndex:h.sourceOutputIndex,sourceSatoshis:i,transactionVersion:u.version,otherInputs:v,inputIndex:a,outputs:u.outputs,inputSequence:h.sequence||4294967295,subscript:s,lockTime:u.lockTime,scope:d}),g=e.sign(r.Hash.sha256(m)),P=new r.TransactionSignature(g.r,g.s,d),S=new r.UnlockingScript;return S.writeBin(P.toChecksigFormat()),S.writeScript(t),Promise.resolve(S)}catch(r){return Promise.reject(r)}},estimateLength:function(){return Promise.resolve(182)}}},e}(),u=function(e){for(var t,n,o,i=0;i<e.chunks.length;i++){var s,u=e.chunks[i];i>=2&&3===(null==(s=u.data)?void 0:s.length)&&"ord"==r.Utils.toUTF8(u.data)&&e.chunks[i-1].op==r.OP.OP_IF&&e.chunks[i-2].op==r.OP.OP_FALSE&&(o=i+1)}if(void 0!==o){for(var a={file:{hash:"",size:0,type:""},fields:{}},c=o;c<e.chunks.length;c+=2){var f,l,d=e.chunks[c];if(d.op==r.OP.OP_ENDIF)break;if(d.op>r.OP.OP_16)return;var h=e.chunks[c+1];if(h.op>r.OP.OP_PUSHDATA4)return;if(null==(f=d.data)||!f.length){var v=0;switch(d.op>r.OP.OP_PUSHDATA4&&d.op<=r.OP.OP_16?v=d.op-80:null!=(l=d.data)&&l.length&&(v=d.data[0]),v){case 0:if(a.file.size=(null==(t=h.data)?void 0:t.length)||0,null==(n=h.data)||!n.length)break;a.file.hash=r.Utils.toBase64(r.Hash.sha256(h.data)),a.file.content=h.data;break;case 1:a.file.type=Buffer.from(h.data||[]).toString()}}}return a}},a=function(e){return e.map(function(e){for(var t=e.chunks,n=0;n<=t.length-6;n++){var o,i;if(t[0+n].op===r.OP.OP_DUP&&t[1+n].op===r.OP.OP_HASH160&&20===(null==(o=t[2+n].data)?void 0:o.length)&&t[3+n].op===r.OP.OP_EQUALVERIFY&&t[4+n].op===r.OP.OP_CHECKSIGVERIFY&&33===(null==(i=t[5+n].data)?void 0:i.length)&&t[6+n].op===r.OP.OP_CHECKSIG)return{cosigner:r.Utils.toHex(t[5+n].data||[]),address:r.Utils.toBase58Check(t[2+n].data||[],[0])}}})},c=function(e,t,n){var o=e.senders.includes(t)?"send":"receive",i=e.height>0?"confirmed":"unconfirmed";if(!e.rawtx)return null;var s=r.Utils.toArray(e.rawtx,"base64"),c=r.Utils.toHex(s),f=r.Transaction.fromHex(c).outputs.map(function(r){return r.lockingScript}),l=a(f),d=f.map(u),h=l.map(function(r){return r.address}),v=h.indexOf(n.feeAddress),p=e.senders[0],m=0,g=new Map;d.forEach(function(e,o){var i,s=null==e||null==(i=e.file)?void 0:i.content;if(s){var u=r.Utils.toUTF8(s);if(u){var a;try{a=JSON.parse(u)}catch(r){return void console.error("Failed to parse inscription JSON:",r)}if("bsv-20"===a.p&&a.id===n.tokenId){var c=parseInt(a.amt,10);if(!Number.isNaN(c))if(v!==o||p!==t){var f=h[o],l=g.get(f)||0;g.set(f,l+c)}else m+=c}}}});var P=g.get(t)||0;if("send"===o){var S=g.get(p)||0;g.set(p,S-P)}var T=[],w=(T="receive"===o?[{address:p,amount:P}]:Array.from(g.entries()).map(function(r){return{address:r[0],amount:r[1]}}).filter(function(r){return r.address!==t&&r.address!==n.feeAddress&&r.amount>0})).reduce(function(r,e){return r+e.amount},0);return{txid:e.txid,height:e.height,type:o,status:i,amount:w,fee:m,score:e.score,counterparties:T}};function f(r,e){try{var t=r()}catch(r){return e(r)}return t&&t.then?t.then(void 0,e):t}function l(r,e,t){if(!r.s){if(t instanceof d){if(!t.s)return void(t.o=l.bind(null,r,e));1&e&&(e=t.s),t=t.v}if(t&&t.then)return void t.then(l.bind(null,r,e),l.bind(null,r,2));r.s=e,r.v=t;var n=r.o;n&&n(r)}}var d=/*#__PURE__*/function(){function r(){}return r.prototype.then=function(e,t){var n=new r,o=this.s;if(o){var i=1&o?e:t;if(i){try{l(n,1,i(this.v))}catch(r){l(n,2,r)}return n}return this}return this.o=function(r){try{var o=r.v;1&r.s?l(n,1,e?e(o):o):t?l(n,1,t(o)):l(n,2,o)}catch(r){l(n,2,r)}},n},r}();function h(r){return r instanceof d&&1&r.s}var v="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function p(r,e,t){if("function"==typeof r[v]){var n,o,i,s=function(r){try{for(;!((n=u.next()).done||t&&t());)if((r=e(n.value))&&r.then){if(!h(r))return void r.then(s,i||(i=l.bind(null,o=new d,2)));r=r.v}o?l(o,1,r):o=r}catch(r){l(o||(o=new d),2,r)}},u=r[v]();if(s(),u.return){var a=function(r){try{n.done||u.return()}catch(r){}return r};if(o&&o.then)return o.then(a,function(r){throw a(r)});a()}return o}if(!("length"in r))throw new TypeError("Object is not iterable");for(var c=[],f=0;f<r.length;f++)c.push(r[f]);return function(r,e,t){var n,o,i=-1;return function s(u){try{for(;++i<r.length&&(!t||!t());)if((u=e(i))&&u.then){if(!h(u))return void u.then(s,o||(o=l.bind(null,n=new d,2)));u=u.v}n?l(n,1,u):n=u}catch(r){l(n||(n=new d),2,r)}}(),n}(c,function(r){return e(c[r])},t)}var m=/*#__PURE__*/function(){function e(r){this.mneeApiToken="92982ec1c0975f31979da515d46bae9f",this.mneeApi="https://proxy-api.mnee.net",this.gorillaPoolApi="https://ordinals.1sat.app",this.mneeConfig=void 0,r&&(this.mneeApiToken=r),this.getConfig()}var t=e.prototype;return t.getConfig=function(){try{var r=this;return Promise.resolve(f(function(){return Promise.resolve(fetch(r.mneeApi+"/v1/config?auth_token="+r.mneeApiToken,{method:"GET"})).then(function(e){if(!e.ok)throw new Error("HTTP error! status: "+e.status);return Promise.resolve(e.json()).then(function(e){return r.mneeConfig=e,e})})},function(r){console.error("Failed to fetch config:",r)}))}catch(r){return Promise.reject(r)}},t.toAtomicAmount=function(r){if(!this.mneeConfig)throw new Error("Config not fetched");return Math.round(r*Math.pow(10,this.mneeConfig.decimals))},t.createInscription=function(e,t,o){try{var i={p:"bsv-20",op:"transfer",id:o.tokenId,amt:t.toString()};return Promise.resolve({lockingScript:n.applyInscription((new s).lock(e,r.PublicKey.fromString(o.approver)),{dataB64:Buffer.from(JSON.stringify(i)).toString("base64"),contentType:"application/bsv-20"}),satoshis:1})}catch(r){return Promise.reject(r)}},t.getUtxos=function(r,e){void 0===e&&(e=["transfer","deploy+mint"]);try{var t=this;return Promise.resolve(f(function(){return Promise.resolve(fetch(t.mneeApi+"/v1/utxos?auth_token="+t.mneeApiToken,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([r])})).then(function(r){if(!r.ok)throw new Error("HTTP error! status: "+r.status);return Promise.resolve(r.json()).then(function(r){return e.length?r.filter(function(r){return e.includes(r.data.bsv21.op.toLowerCase())}):r})})},function(r){return console.error("Failed to fetch UTXOs:",r),[]}))}catch(r){return Promise.reject(r)}},t.broadcast=function(r){try{var e=this.gorillaPoolApi+"/v5/tx";return Promise.resolve(f(function(){return Promise.resolve(fetch(e,{method:"POST",headers:{"Content-Type":"application/octet-stream"},body:Buffer.from(r.toBinary())})).then(function(r){return Promise.resolve(r.json()).then(function(e){return r.ok?{status:"success",txid:e.txid,message:"Transaction broadcast successfully"}:{status:"error",code:r.status.toString(),description:e.error||"Unknown error"}})})},function(r){return console.error("Failed to broadcast:",r),{status:"error",code:"UNKNOWN",description:r instanceof Error?r.message:"Unknown error"}}))}catch(r){return Promise.reject(r)}},t.fetchBeef=function(e){try{return Promise.resolve(fetch(this.gorillaPoolApi+"/v5/tx/"+e+"/beef")).then(function(t){if(404===t.status)throw new Error("Transaction not found");if(200!==t.status)throw new Error(t.status+" - Failed to fetch beef for tx "+e);var n=Buffer,o=n.from;return Promise.resolve(t.arrayBuffer()).then(function(e){var t=[].concat(o.call(n,e));return r.Transaction.fromAtomicBEEF(t)})})}catch(r){return Promise.reject(r)}},t.getSignatures=function(e,t){try{try{var n;switch(e.format){case"beef":n=r.Transaction.fromHexBEEF(e.rawtx);break;case"ef":n=r.Transaction.fromHexEF(e.rawtx);break;default:n=r.Transaction.fromHex(e.rawtx)}var o=e.sigRequests.flatMap(function(e){return[t].map(function(t){var o=r.TransactionSignature.format({sourceTXID:e.prevTxid,sourceOutputIndex:e.outputIndex,sourceSatoshis:e.satoshis,transactionVersion:n.version,otherInputs:n.inputs.filter(function(r,t){return t!==e.inputIndex}),inputIndex:e.inputIndex,outputs:n.outputs,inputSequence:n.inputs[e.inputIndex].sequence||0,subscript:e.script?r.Script.fromHex(e.script):(new r.P2PKH).lock(t.toPublicKey().toAddress()),lockTime:n.lockTime,scope:e.sigHashType||65}),i=t.sign(r.Hash.sha256(o)),s=new r.TransactionSignature(i.r,i.s,e.sigHashType||65);return{sig:r.Utils.toHex(s.toChecksigFormat()),pubKey:t.toPublicKey().toString(),inputIndex:e.inputIndex,sigHashType:e.sigHashType||65,csIdx:e.csIdx}})});return Promise.resolve({sigResponses:o})}catch(r){var i;return console.error("getSignatures error",r),Promise.resolve({error:{message:null!=(i=r.message)?i:"unknown",cause:r.cause}})}}catch(r){return Promise.reject(r)}},t.transfer=function(e,t){try{var n=this;return Promise.resolve(f(function(){function o(o){if(!o)throw new Error("Config not fetched");var s=e.reduce(function(r,e){return r+e.amount},0);if(s<=0)return{error:"Invalid amount"};var u=n.toAtomicAmount(s),a=r.PrivateKey.fromWif(t),c=a.toAddress();return Promise.resolve(n.getUtxos(c)).then(function(t){var s,c;function f(t){if(c)return t;function s(){function e(){function e(){var e=m.inputs.map(function(e,t){var n,o;if(!e.sourceTXID)throw new Error("Source TXID is undefined");return{prevTxid:e.sourceTXID,outputIndex:e.sourceOutputIndex,inputIndex:t,address:P[t],script:null==(n=e.sourceTransaction)?void 0:n.outputs[e.sourceOutputIndex].lockingScript.toHex(),satoshis:(null==(o=e.sourceTransaction)?void 0:o.outputs[e.sourceOutputIndex].satoshis)||1,sigHashType:r.TransactionSignature.SIGHASH_ALL|r.TransactionSignature.SIGHASH_ANYONECANPAY|r.TransactionSignature.SIGHASH_FORKID}}),t=m.toHex();return Promise.resolve(n.getSignatures({rawtx:t,sigRequests:e},a)).then(function(e){if(null==e||!e.sigResponses)return{error:"Failed to get signatures"};for(var t,o=i(e.sigResponses);!(t=o()).done;){var s=t.value;m.inputs[s.inputIndex].unlockingScript=(new r.Script).writeBin(r.Utils.toArray(s.sig,"hex")).writeBin(r.Utils.toArray(s.pubKey,"hex"))}var u=r.Utils.toBase64(m.toBinary());return Promise.resolve(fetch(n.mneeApi+"/v1/transfer?auth_token="+n.mneeApiToken,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rawtx:u})})).then(function(e){if(!e.ok)throw new Error("HTTP error! status: "+e.status);return Promise.resolve(e.json()).then(function(e){var t=e.rawtx;if(!t)return{error:"Failed to broadcast transaction"};var o=r.Utils.toArray(t,"base64"),i=r.Transaction.fromBinary(o);return Promise.resolve(n.broadcast(i)).then(function(){return{txid:i.id("hex"),rawtx:r.Utils.toHex(o)}})})})})}var t=g-u-v,s=function(){if(t>0){var r=m.addOutput;return Promise.resolve(n.createInscription(S,t,o)).then(function(e){r.call(m,e)})}}();return s&&s.then?s.then(e):e()}var t=function(){if(v>0){var r=m.addOutput;return Promise.resolve(n.createInscription(o.feeAddress,v,o)).then(function(e){r.call(m,e)})}}();return t&&t.then?t.then(e):e()}var f=p(e,function(r){var e=m.addOutput;return Promise.resolve(n.createInscription(r.address,n.toAtomicAmount(r.amount),o)).then(function(r){e.call(m,r)})});return f&&f.then?f.then(s):s()}if(t.reduce(function(r,e){return r+(e.data.bsv21.amt||0)},0)<u)return{error:"Insufficient MNEE balance"};var v=void 0!==e.find(function(r){return r.address===o.burnAddress})?0:null==(s=o.fees.find(function(r){return u>=r.min&&u<=r.max}))?void 0:s.fee;if(void 0===v)return{error:"Fee ranges inadequate"};var m=new r.Transaction(1,[],[],0),g=0,P=[],S="",T=function(r,e,t){for(var n;;){var o=r();if(h(o)&&(o=o.v),!o)return i;if(o.then){n=0;break}var i=t();if(i&&i.then){if(!h(i)){n=1;break}i=i.s}}var s=new d,u=l.bind(null,s,2);return(0===n?o.then(c):1===n?i.then(a):(void 0).then(function(){(o=r())?o.then?o.then(c).then(void 0,u):c(o):l(s,1,i)})).then(void 0,u),s;function a(e){i=e;do{if(!(o=r())||h(o)&&!o.v)return void l(s,1,i);if(o.then)return void o.then(c).then(void 0,u);h(i=t())&&(i=i.v)}while(!i||!i.then);i.then(a).then(void 0,u)}function c(r){r?(i=t())&&i.then?i.then(a).then(void 0,u):a(i):l(s,1,i)}}(function(){return!c&&g<u+v},0,function(){var e=t.shift();return e?Promise.resolve(n.fetchBeef(e.txid)).then(function(t){if(!t)return c=1,{error:"Failed to fetch source transaction"};P.push(e.owners[0]),S=S||e.owners[0],m.addInput({sourceTXID:e.txid,sourceOutputIndex:e.vout,sourceTransaction:t,unlockingScript:new r.UnlockingScript}),g+=e.data.bsv21.amt}):(c=1,{error:"Insufficient MNEE balance"})});return T&&T.then?T.then(f):f(T)})}var s=n.mneeConfig;return s?o(s):Promise.resolve(n.getConfig()).then(o)},function(r){var e="Transaction submission failed";return r instanceof Error&&(e=r.message,r.message.includes("HTTP error")&&console.error("HTTP error details:",r)),console.error("Failed to transfer tokens:",e),{error:e}}))}catch(r){return Promise.reject(r)}},t.getBalance=function(r){try{var e=this;return Promise.resolve(f(function(){function t(t){if(!t)throw new Error("Config not fetched");return Promise.resolve(e.getUtxos(r)).then(function(r){var e=r.reduce(function(r,e){return"transfer"===e.data.bsv21.op&&(r+=e.data.bsv21.amt),r},0);return{amount:e,decimalAmount:parseFloat((e/Math.pow(10,t.decimals||0)).toFixed(t.decimals))}})}var n=e.mneeConfig;return n?t(n):Promise.resolve(e.getConfig()).then(t)},function(r){return console.error("Failed to fetch balance:",r),{amount:0,decimalAmount:0}}))}catch(r){return Promise.reject(r)}},t.validateMneeTx=function(e,t){try{var n=this;try{if(!n.mneeConfig)throw new Error("Config not fetched");var o=r.Transaction.fromHex(e),i=o.outputs.map(function(r){return r.lockingScript}),s=a(i);return t?t.forEach(function(e,t){var i,a=e.address,c=e.amount;if(!s.find(function(r){return(null==r?void 0:r.cosigner)===n.mneeConfig.approver}))throw new Error("Cosigner not found for address: "+a+" at index: "+t);if(!s.find(function(r){return(null==r?void 0:r.address)===a}))throw new Error("Address not found in script for address: "+a+" at index: "+t);var f=u(o.outputs[t].lockingScript),l=null==f||null==(i=f.file)?void 0:i.content;if(!l)throw new Error("Invalid inscription content");var d=r.Utils.toUTF8(l);if(!d)throw new Error("Invalid inscription content");var h=JSON.parse(d);if("bsv-20"!==h.p)throw new Error("Invalid bsv 20 protocol: "+h.p);if("transfer"!==h.op)throw new Error("Invalid operation: "+h.op);if(h.id!==n.mneeConfig.tokenId)throw new Error("Invalid token id: "+h.id);if(h.amt!==Math.round(c*Math.pow(10,n.mneeConfig.decimals)).toString())throw new Error("Invalid amount: "+h.amt)}):s.forEach(function(r){if(r&&r.cosigner!==n.mneeConfig.approver)throw new Error("Invalid cosigner: "+r.cosigner)}),Promise.resolve(!0)}catch(r){return console.error(r),Promise.resolve(!1)}}catch(r){return Promise.reject(r)}},t.getMneeSyncs=function(r,e,t){void 0===e&&(e=0),void 0===t&&(t=100);try{var n=this;return Promise.resolve(f(function(){return Promise.resolve(fetch(n.mneeApi+"/v1/sync?auth_token="+n.mneeApiToken+"&from="+e+"&limit="+t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([r])})).then(function(r){if(!r.ok)throw new Error("HTTP error! status: "+r.status);return Promise.resolve(r.json())})},function(r){console.error("Failed to fetch config:",r)}))}catch(r){return Promise.reject(r)}},t.getRecentTxHistory=function(r,e,t){try{var n=this;return Promise.resolve(f(function(){function o(o){if(!o)throw new Error("Config not fetched");return Promise.resolve(n.getMneeSyncs(r,e,t)).then(function(n){if(!n||0===n.length)return{history:[],nextScore:e||0};for(var s,u=[],a=i(n);!(s=a()).done;){var f=c(s.value,r,o);f&&u.push(f)}var l=u.sort(function(r,e){return e.height-r.height}).sort(function(r,e){return"unconfirmed"===r.status?-1:1});return 0===l.length?{history:[],nextScore:e||0}:t&&l.length>t?{history:l.slice(0,t),nextScore:l[t-1].score}:{history:l,nextScore:u[u.length-1].score}})}var s=n.mneeConfig;return s?o(s):Promise.resolve(n.getConfig()).then(o)},function(r){return console.error("Failed to fetch tx history:",r),{history:[],nextScore:e||0}}))}catch(r){return Promise.reject(r)}},t.parseTx=function(e){try{var t=function(t){return Promise.resolve(n.fetchBeef(e)).then(function(o){function s(){for(var n,o=i(c);!(n=o()).done;){var s,f=n.value,h=a([f])[0];if((null==h?void 0:h.cosigner)===(null==t?void 0:t.approver)){var v=u(f),p=null==v||null==(s=v.file)?void 0:s.content;if(p){var m=r.Utils.toUTF8(p);if(m){var g=JSON.parse(m);g&&d.push({address:h.address,amount:parseInt(g.amt)})}}}}if(l.reduce(function(r,e){return r+e.amount},0)!==d.reduce(function(r,e){return r+e.amount},0))throw new Error("Inputs and outputs are not equal");return{txid:e,inputs:l,outputs:d}}if(!o)throw new Error("Failed to fetch transaction");var c=o.outputs.map(function(r){return r.lockingScript}),f=o.inputs.map(function(r){return{txid:r.sourceTXID,vout:r.sourceOutputIndex}}),l=[],d=[],h=p(f,function(e){if(e.txid)return Promise.resolve(n.fetchBeef(e.txid)).then(function(n){var o,i=n.outputs[e.vout],s=a([i.lockingScript])[0];if((null==s?void 0:s.cosigner)===(null==t?void 0:t.approver)){var c=u(i.lockingScript),f=null==c||null==(o=c.file)?void 0:o.content;if(f){var d=r.Utils.toUTF8(f);if(d){var h=JSON.parse(d);h&&l.push({address:s.address,amount:parseInt(h.amt)})}}}})});return h&&h.then?h.then(s):s()})},n=this,o=n.mneeConfig;return Promise.resolve(o?t(o):Promise.resolve(n.getConfig()).then(t))}catch(r){return Promise.reject(r)}},e}();/*#__PURE__*/
return function(){function r(r){this.service=void 0,this.service=new m(r)}var e=r.prototype;return e.validateMneeTx=function(r,e){try{return Promise.resolve(this.service.validateMneeTx(r,e))}catch(r){return Promise.reject(r)}},e.toAtomicAmount=function(r){return this.service.toAtomicAmount(r)},e.config=function(){try{return Promise.resolve(this.service.getConfig())}catch(r){return Promise.reject(r)}},e.balance=function(r){try{return Promise.resolve(this.service.getBalance(r))}catch(r){return Promise.reject(r)}},e.transfer=function(r,e){try{return Promise.resolve(this.service.transfer(r,e))}catch(r){return Promise.reject(r)}},e.recentTxHistory=function(r,e,t){try{return Promise.resolve(this.service.getRecentTxHistory(r,e,t))}catch(r){return Promise.reject(r)}},e.parseTx=function(r){try{return Promise.resolve(this.service.parseTx(r))}catch(r){return Promise.reject(r)}},r}()});
//# sourceMappingURL=index.umd.js.map
