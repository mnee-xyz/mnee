console.log('>>> TEST FILE EXECUTED');
import test from 'node:test';
import assert from 'node:assert';
import MNEEService from '../dist/mnee.modern.modern.js';
import dotenv from 'dotenv';

dotenv.config();

const ENV = process.env.MNEE_ENVIRONMENT || 'sandbox';
let LICENSE = '';
if (ENV === 'production') {
  LICENSE = process.env.MNEE_LICENSE_PROD || '';
} else {
  LICENSE = process.env.MNEE_LICENSE_SANDBOX || '';
}
if (!LICENSE) {
  throw new Error(`Missing license for environment '${ENV}'. Please set MNEE_LICENSE_${ENV.toUpperCase()} in your .env file.`);
}

test('MNEEService Transaction Parsing', async (t) => {
  const mneeService = new MNEEService({
    environment: ENV,
    license: LICENSE,
  });

  const transactionsToTest = {
    'bsv-20-cache0.hex': '0100000002ce58fdd9625afbc291b61395b227e184f48e898fa095f22abeff3c6efec01fa302000000b24730440220103272b525abdfd064976c4868d10921adb30bb0a1a39cd3b7097d35c5c81f86022043098cf9a56a505413b59a74bb7e48de66d0e5e2b9086b29082e2bd0d70952004147304402201a135eb4befefd4f0c5223966097c7073cb28c6b0a3572aa335cf8c11bcf3153022034eb410cd67df9b88cf1adad23e883ea01ccf8f58dbce468bc0e75d6428139dbc121038bfdcaa97fbd3c2994ac690d6e84c7b0b506a6758d694e1b3e10cc8841937f1effffffff2ea6f8c51ef4e91f0156ce9c1b9a39f9c2b2ff5d476d01a1d94104e1f12725c2000000006b483045022100fb12e11f372dbffc7f032a037d7929036fbb1b9befee7434965e06cc4dfa0fc202201db2b879fabcd27bddc51e041c70a2487e00c3004a3151e15cb0945a377ba6b8412102bed35e894cc41cc9879b4002ad03d33533b615c1b476068c8dd6822a09f93f6cffffffff030100000000000000d00063036f726451126170706c69636174696f6e2f6273762d3230004c767b2270223a226273762d3230222c226f70223a227472616e73666572222c226964223a22383333613737323039363661326134333564623238643936373338356538616137323834623631353065626233393438326363353232386237336531373033665f30222c22616d74223a223133323134227d6876a9144ba9916a4a65f7520ccb5541cb6510d5938d747788ad2102bed35e894cc41cc9879b4002ad03d33533b615c1b476068c8dd6822a09f93f6cac0100000000000000ce0063036f726451126170706c69636174696f6e2f6273762d3230004c747b2270223a226273762d3230222c226f70223a227472616e73666572222c226964223a22383333613737323039363661326134333564623238643936373338356538616137323834623631353065626233393438326363353232386237336531373033665f30222c22616d74223a22313030227d6876a914b132fb8440e2d45b60d50ce8680aa9d0d316ab7288ad2102bed35e894cc41cc9879b4002ad03d33533b615c1b476068c8dd6822a09f93f6cac0100000000000000ce0063036f726451126170706c69636174696f6e2f6273762d3230004c747b2270223a226273762d3230222c226f70223a227472616e73666572222c226964223a22383333613737323039363661326134333564623238643936373338356538616137323834623631353065626233393438326363353232386237336531373033665f30222c22616d74223a22323038227d6876a914670c1208045a3bab313a81cd3d6eb3ae1c30a5e388ad2102bed35e894cc41cc9879b4002ad03d33533b615c1b476068c8dd6822a09f93f6cac00000000',
    'bsv-20-scan2batch.hex': '0100000003d133c13f1c98b1dd8036dbf0a9cdff73b9bc4b90f76dd783d3c9568a52be844002000000b347304402202ddaf7a97e68c0ec7ecb6a21ba7b97c67d62fd2dffcf17ac6a89ff61c9deacf8022059e8c6de2fe2e4d2d940327c38f8ae85c896cc985588742effb309567573daa741483045022100a1006c05838cfcfe74a48a08747a71e4fc25f5d058a1fcd3fc770fc951664ec502207a096c10509746dea8b1afc8f6447c8aa51982406daf66feb8f498c5e7d623b2c121025b7057dd85277d4212b331eec6b1ce9be804aa9d1dc5e26c2ccfcc91b71a9276ffffffffd133c13f1c98b1dd8036dbf0a9cdff73b9bc4b90f76dd783d3c9568a52be844000000000b3473044022054145830928abfb186f52b3fea0bdb825405b2517cffeccf5b30170d80d0f56802201ece5106fa7dea66112e4d72b5a912569deb813a80f3b57ff7def24d43f76e9241483045022100936afe340e733efc951fb3d2d56efc5e9f2557b1071bcf5761afb26b5746f1f702202eb96a3e6b552f8fd54a4c51fb3ab9b84dbae66dcc4f1f814d0fb36671a64cabc1210328a0bf34fc40b627d7b3d90d11d293ccd3ccfab8e81e670e136fa78c005cb130ffffffff3c43594b942a9c716a4b5fb19fea963fc4fd3f1c9cfbc5cd35c6d2872ebc2803000000006a47304402200996608d5407938df445edb758493affb2dc143931d37e956d146a01c184b5a8022054583c039a130b1d75f4b39b50972614214326dff0c24e6e90bd0e0ff06d7801412102bed35e894cc41cc9879b4002ad03d33533b615c1b476068c8dd6822a09f93f6cffffffff030100000000000000d00063036f726451126170706c69636174696f6e2f6273762d3230004c767b2270223a226273762d3230222c226f70223a227472616e73666572222c226964223a22383333613737323039363661326134333564623238643936373338356538616137323834623631353065626233393438326363353232386237336531373033665f30222c22616d74223a223139393039227d6876a914aadd1e31b7eb6c44f5684342f314cd1ba6560f6388ad2102bed35e894cc41cc9879b4002ad03d33533b615c1b476068c8dd6822a09f93f6cac0100000000000000ce0063036f726451126170706c69636174696f6e2f6273762d3230004c747b2270223a226273762d3230222c226f70223a227472616e73666572222c226964223a22383333613737323039363661326134333564623238643936373338356538616137323834623631353065626233393438326363353232386237336531373033665f30222c22616d74223a22313030227d6876a914b132fb8440e2d45b60d50ce8680aa9d0d316ab7288ad2102bed35e894cc41cc9879b4002ad03d33533b615c1b476068c8dd6822a09f93f6cac0100000000000000d00063036f726451126170706c69636174696f6e2f6273762d3230004c767b2270223a226273762d3230222c226f70223a227472616e73666572222c226964223a22383333613737323039363661326134333564623238643936373338356538616137323834623631353065626233393438326363353232386237336531373033665f30222c22616d74223a223130363535227d6876a914afd9c9bdf93b3a179b3c25b2899e81bc0034e97d88ad2102bed35e894cc41cc9879b4002ad03d33533b615c1b476068c8dd6822a09f93f6cac00000000'
  };

  for (const [fileName, txHex] of Object.entries(transactionsToTest)) {
    await t.test(`MNEEService parses a valid transaction from ${fileName}`, async () => {
      const result = await mneeService.parseTxFromRawTx(txHex);
      assert.ok(result, 'Should return a result object');
      assert.ok(result.txid, 'Should have a txid');
      assert.ok(Array.isArray(result.inputs), 'Inputs should be an array');
      assert.ok(Array.isArray(result.outputs), 'Outputs should be an array');
    });
  }
});
